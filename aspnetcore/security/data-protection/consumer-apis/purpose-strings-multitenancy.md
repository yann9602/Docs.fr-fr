---
title: "Chaînes d’objectif dans ASP.NET Core"
author: rick-anderson
description: 
keywords: ASP.NET Core,
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.assetid: 9d18c287-e0e6-4541-b09c-7fed45c902d9
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/consumer-apis/purpose-strings-multitenancy
ms.openlocfilehash: b25af7c1f4dd3c63734290e6ac82e2e30a030c61
ms.sourcegitcommit: e3b1726cc04e80dc28464c35259edbd3bc39a438
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/12/2017
---
# <a name="purpose-hierarchy-and-multi-tenancy-in-aspnet-core"></a><span data-ttu-id="b43f6-103">Hiérarchie d’objet et une architecture mutualisée dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b43f6-103">Purpose hierarchy and multi-tenancy in ASP.NET Core</span></span>

<span data-ttu-id="b43f6-104">Étant un IDataProtector également implicitement un IDataProtectionProvider, à des fins peuvent être chaînés ensemble.</span><span class="sxs-lookup"><span data-stu-id="b43f6-104">Since an IDataProtector is also implicitly an IDataProtectionProvider, purposes can be chained together.</span></span> <span data-ttu-id="b43f6-105">Dans ce fournisseur de détection. CreateProtector ([« purpose1 », « purpose2 »]) équivaut au fournisseur. CreateProtector("purpose1"). CreateProtector("purpose2").</span><span class="sxs-lookup"><span data-stu-id="b43f6-105">In this sense provider.CreateProtector([ "purpose1", "purpose2" ]) is equivalent to provider.CreateProtector("purpose1").CreateProtector("purpose2").</span></span>

<span data-ttu-id="b43f6-106">Ainsi, pour certaines relations hiérarchiques intéressantes via le système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="b43f6-106">This allows for some interesting hierarchical relationships through the data protection system.</span></span> <span data-ttu-id="b43f6-107">Dans l’exemple précédent de [Contoso.Messaging.SecureMessage](purpose-strings.md#data-protection-contoso-purpose), le composant SecureMessage peut appeler le fournisseur. CreateProtector("Contoso.Messaging.SecureMessage") une fois qu’initial et cache le résultat dans un privé `_myProvide` champ.</span><span class="sxs-lookup"><span data-stu-id="b43f6-107">In the earlier example of [Contoso.Messaging.SecureMessage](purpose-strings.md#data-protection-contoso-purpose), the SecureMessage component can call provider.CreateProtector("Contoso.Messaging.SecureMessage") once upfront and cache the result into a private `_myProvide` field.</span></span> <span data-ttu-id="b43f6-108">Les protecteurs de futurs peuvent ensuite être créées via des appels à `_myProvider.CreateProtector("User: username")`, et ces protecteurs sont utilisées pour la sécurisation des messages individuels.</span><span class="sxs-lookup"><span data-stu-id="b43f6-108">Future protectors can then be created via calls to `_myProvider.CreateProtector("User: username")`, and these protectors would be used for securing the individual messages.</span></span>

<span data-ttu-id="b43f6-109">Cela peut également être inversé.</span><span class="sxs-lookup"><span data-stu-id="b43f6-109">This can also be flipped.</span></span> <span data-ttu-id="b43f6-110">Envisagez une seule application logique qui héberge plusieurs clients (un CMS semble raisonnable) et chaque client peuvent être configuré avec son propre système de gestion de l’authentification et l’état.</span><span class="sxs-lookup"><span data-stu-id="b43f6-110">Consider a single logical application which hosts multiple tenants (a CMS seems reasonable), and each tenant can be configured with its own authentication and state management system.</span></span> <span data-ttu-id="b43f6-111">L’application couvrant possède un seul fournisseur de master, et il appelle le fournisseur. CreateProtector (« Tenant 1 ») et le fournisseur. CreateProtector (« Tenant 2 ») pour donner à chaque client de sa propre tranche isolé du système de protection des données.</span><span class="sxs-lookup"><span data-stu-id="b43f6-111">The umbrella application has a single master provider, and it calls provider.CreateProtector("Tenant 1") and provider.CreateProtector("Tenant 2") to give each tenant its own isolated slice of the data protection system.</span></span> <span data-ttu-id="b43f6-112">Les locataires peuvent ensuite dériver leurs propres protecteurs individuels en fonction de leurs propres besoins, mais quel que soit le manuels ils tentent ne peut pas créer protecteurs qui entrent en conflit avec n’importe quel autre client dans le système.</span><span class="sxs-lookup"><span data-stu-id="b43f6-112">The tenants could then derive their own individual protectors based on their own needs, but no matter how hard they try they cannot create protectors which collide with any other tenant in the system.</span></span> <span data-ttu-id="b43f6-113">Graphiquement, cela est représenté comme indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="b43f6-113">Graphically this is represented as below.</span></span>

![À des fins de location de multiples](purpose-strings-multitenancy/_static/purposes-multi-tenancy.png)

>[!WARNING]
> <span data-ttu-id="b43f6-115">Cela suppose que le cadre des contrôles d’application les API sont disponibles pour les locataires individuels et que les clients ne peuvent pas exécuter du code arbitraire sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="b43f6-115">This assumes the umbrella application controls which APIs are available to individual tenants and that tenants cannot execute arbitrary code on the server.</span></span> <span data-ttu-id="b43f6-116">Si un client peut exécuter du code arbitraire, qu’ils puissent exécuter réflexion privée pour interrompre la garantie d’isolation ou elles Impossible de lire directement la gestion de clés principales et dériver les sous-clés simplement qu’il souhaite.</span><span class="sxs-lookup"><span data-stu-id="b43f6-116">If a tenant can execute arbitrary code, they could perform private reflection to break the isolation guarantees, or they could just read the master keying material directly and derive whatever subkeys they desire.</span></span>

<span data-ttu-id="b43f6-117">Le système de protection de données utilise en fait une sorte d’une architecture mutualisée dans sa configuration de l’emploi par défaut.</span><span class="sxs-lookup"><span data-stu-id="b43f6-117">The data protection system actually uses a sort of multi-tenancy in its default out-of-the-box configuration.</span></span> <span data-ttu-id="b43f6-118">Par défaut, gestion des clés principales sont stockées dans le dossier du profil utilisateur du compte de processus de travail (ou le Registre, pour les identités du pool d’applications IIS).</span><span class="sxs-lookup"><span data-stu-id="b43f6-118">By default master keying material is stored in the worker process account's user profile folder (or the registry, for IIS application pool identities).</span></span> <span data-ttu-id="b43f6-119">Mais il est réellement assez courant d’utiliser un seul compte pour exécuter plusieurs applications, et par conséquent, toutes ces applications risque d’entraîner un partage le maître de support de gestion.</span><span class="sxs-lookup"><span data-stu-id="b43f6-119">But it is actually fairly common to use a single account to run multiple applications, and thus all these applications would end up sharing the master keying material.</span></span> <span data-ttu-id="b43f6-120">Pour résoudre ce problème, le système de protection des données insère automatiquement un identificateur unique par application en tant que le premier élément dans la chaîne de l’objectif global.</span><span class="sxs-lookup"><span data-stu-id="b43f6-120">To solve this, the data protection system automatically inserts a unique-per-application identifier as the first element in the overall purpose chain.</span></span> <span data-ttu-id="b43f6-121">Cet effet implicit qui sert à [isoler les applications individuelles](../configuration/overview.md#data-protection-configuration-per-app-isolation) entre eux en traitant efficacement chaque application comme un client unique dans le système et le processus de création de protecteur est identique à l’image ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="b43f6-121">This implicit purpose serves to [isolate individual applications](../configuration/overview.md#data-protection-configuration-per-app-isolation) from one another by effectively treating each application as a unique tenant within the system, and the protector creation process looks identical to the image above.</span></span>
